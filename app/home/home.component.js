"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var data_service_1 = require("../core/data.service");
var gestures_1 = require("tns-core-modules/ui/gestures");
var platform_1 = require("tns-core-modules/platform");
var swipe_layout_enums_1 = require("../nativescript-swipe-layout/swipe-layout.enums");
var animations_1 = require("@angular/animations");
var HomeComponent = /** @class */ (function () {
    function HomeComponent(_dataService, _cd) {
        this._dataService = _dataService;
        this._cd = _cd;
        this.isLoaded = false;
        this._swipeLayouts = [];
        this.swipeLayoutAnimated = swipe_layout_enums_1.ANIMATION_STATE.ON_EVENTS;
        this.gestureMode = swipe_layout_enums_1.GESTURE_MODE.DRAG;
    }
    HomeComponent.prototype.ngAfterContentInit = function () {
        var _this = this;
        if (platform_1.isAndroid) {
            setTimeout(function () {
                _this.isLoaded = true;
            }, 2200);
        }
        else {
            setTimeout(function () {
                _this.isLoaded = true;
            }, 500);
        }
    };
    HomeComponent.prototype.ngOnInit = function () {
        this.initCards();
    };
    HomeComponent.prototype.initCards = function () {
        this.cards = this._dataService.getUnseenItems().reverse() || [];
    };
    HomeComponent.prototype.swipeLayoutLoaded = function (event, btnLike, btnIgnore, badgeLike, badgeIgnore) {
        var _this = this;
        var swipeLayout = event.object;
        this._swipeLayouts.push(swipeLayout);
        swipeLayout.on(gestures_1.GestureTypes.pan, function (args) {
            var vectorLength = (Math.sqrt(Math.pow(args.deltaX, 2) + Math.pow(args.deltaY, 2)));
            btnLike.opacity = _this.mapVectorLengthToOpacity(vectorLength);
            btnIgnore.opacity = _this.mapVectorLengthToOpacity(vectorLength);
            badgeLike.opacity = _this.badgeOpacity(args.deltaX);
            badgeIgnore.opacity = _this.badgeOpacity(-args.deltaX);
        });
        swipeLayout.on(gestures_1.GestureTypes.touch, function (args) {
            if (args.action === "up") {
                btnLike.animate({ opacity: 1, duration: 500 });
                btnIgnore.animate({ opacity: 1, duration: 500 });
                badgeLike.animate({ opacity: 0, duration: 500 });
                badgeIgnore.animate({ opacity: 0, duration: 500 });
            }
        });
    };
    HomeComponent.prototype.onContainerLoaded = function (args) {
        this._currentSwipeLayout = this._swipeLayouts[0];
    };
    HomeComponent.prototype.swipeLeftCallback = function (swipeLeftEvent, card) {
        card.liked = false;
        this.next(card);
    };
    HomeComponent.prototype.swipeRightCallback = function (swipeRightEvent, card) {
        card.liked = true;
        this.next(card);
    };
    HomeComponent.prototype.decline = function (card) {
        var _this = this;
        card.liked = false;
        this._currentSwipeLayout.animateSwipeRight().then(function () {
            _this.next(card);
        });
    };
    HomeComponent.prototype.like = function (card) {
        var _this = this;
        card.liked = true;
        this._currentSwipeLayout.animateSwipeLeft().then(function () {
            _this.next(card);
        });
    };
    HomeComponent.prototype.trackingFunction = function (index, item) {
        return item.id;
    };
    HomeComponent.prototype.resetCards = function () {
        this._dataService.resetItems();
        this.initCards();
        console.log(this.cards.length);
    };
    HomeComponent.prototype.mapVectorLengthToOpacity = function (l) {
        return (l - 0) * (0 - 1) / (80 - 0) + 1;
    };
    HomeComponent.prototype.badgeOpacity = function (deltaX) {
        return (deltaX - 20) * (1 - 0) / (120 - 20) + 0;
    };
    HomeComponent.prototype.next = function (card) {
        card.viewed = true;
        this._swipeLayouts.shift();
        this.cards.shift();
        this._currentSwipeLayout = this._swipeLayouts[0];
        this._dataService.updateItem(card);
        this._cd.detectChanges();
    };
    HomeComponent = __decorate([
        core_1.Component({
            selector: "Home",
            moduleId: module.id,
            templateUrl: "./home.component.html",
            animations: [
                animations_1.trigger("fade", [
                    animations_1.transition(":enter", [
                        animations_1.style({ opacity: 0 }),
                        animations_1.animate(200, animations_1.style({ opacity: 1 }))
                    ]),
                    animations_1.transition(":leave", [
                        animations_1.animate(200, animations_1.style({ opacity: 0 }))
                    ])
                ])
            ]
        }),
        __metadata("design:paramtypes", [data_service_1.DataService, core_1.ChangeDetectorRef])
    ], HomeComponent);
    return HomeComponent;
}());
exports.HomeComponent = HomeComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaG9tZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJob21lLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHNDQUF1RjtBQUN2RixxREFBOEQ7QUFDOUQseURBQXdHO0FBQ3hHLHNEQUFzRDtBQUV0RCxzRkFBZ0c7QUFDaEcsa0RBQTBFO0FBa0IxRTtJQVFJLHVCQUFvQixZQUF5QixFQUFVLEdBQXNCO1FBQXpELGlCQUFZLEdBQVosWUFBWSxDQUFhO1FBQVUsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUFMN0UsYUFBUSxHQUFZLEtBQUssQ0FBQztRQU10QixJQUFJLENBQUMsYUFBYSxHQUFHLEVBQUUsQ0FBQztRQUN4QixJQUFJLENBQUMsbUJBQW1CLEdBQUcsb0NBQWUsQ0FBQyxTQUFTLENBQUM7UUFDckQsSUFBSSxDQUFDLFdBQVcsR0FBRyxpQ0FBWSxDQUFDLElBQUksQ0FBQztJQUN6QyxDQUFDO0lBRUQsMENBQWtCLEdBQWxCO1FBQUEsaUJBV0M7UUFWRyxJQUFJLG9CQUFTLEVBQUU7WUFDWCxVQUFVLENBQUM7Z0JBQ1AsS0FBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7WUFDekIsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO1NBQ1o7YUFBTTtZQUNILFVBQVUsQ0FBQztnQkFDUCxLQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztZQUN6QixDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7U0FDWDtJQUVMLENBQUM7SUFFRCxnQ0FBUSxHQUFSO1FBQ0ksSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ3JCLENBQUM7SUFFRCxpQ0FBUyxHQUFUO1FBQ0ksSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLGNBQWMsRUFBRSxDQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQztJQUNwRSxDQUFDO0lBRUQseUNBQWlCLEdBQWpCLFVBQWtCLEtBQUssRUFBRSxPQUFPLEVBQUUs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RUFBRSxDQUFDO0lBQzdCLENBQUM7SUE1R1EsYUFBYTtRQWhCekIsZ0JBQVMsQ0FBQztZQUNQLFFBQVEsRUFBRSxNQUFNO1lBQ2hCLFFBQVEsRUFBRSxNQUFNLENBQUMsRUFBRTtZQUNuQixXQUFXLEVBQUUsdUJBQXVCO1lBQ3BDLFVBQVUsRUFBRTtnQkFDUixvQkFBTyxDQUFDLE1BQU0sRUFBRTtvQkFDWix1QkFBVSxDQUFDLFFBQVEsRUFBRTt3QkFDakIsa0JBQUssQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQzt3QkFDckIsb0JBQU8sQ0FBQyxHQUFHLEVBQUUsa0JBQUssQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO3FCQUN0QyxDQUFDO29CQUNGLHVCQUFVLENBQUMsUUFBUSxFQUFFO3dCQUNqQixvQkFBTyxDQUFDLEdBQUcsRUFBRSxrQkFBSyxDQUFDLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7cUJBQ3RDLENBQUM7aUJBQ0wsQ0FBQzthQUNMO1NBQ0osQ0FBQzt5Q0FTb0MsMEJBQVcsRUFBZSx3QkFBaUI7T0FScEUsYUFBYSxDQTZHekI7SUFBRCxvQkFBQztDQUFBLEFBN0dELElBNkdDO0FBN0dZLHNDQUFhIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWZ0ZXJDb250ZW50SW5pdCwgQ29tcG9uZW50LCBPbkluaXQsIENoYW5nZURldGVjdG9yUmVmIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IERhdGFTZXJ2aWNlLCBJRGF0YUl0ZW0gfSBmcm9tIFwiLi4vY29yZS9kYXRhLnNlcnZpY2VcIjtcbmltcG9ydCB7IEdlc3R1cmVUeXBlcywgUGFuR2VzdHVyZUV2ZW50RGF0YSwgVG91Y2hHZXN0dXJlRXZlbnREYXRhIH0gZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvdWkvZ2VzdHVyZXNcIjtcbmltcG9ydCB7IGlzQW5kcm9pZCB9IGZyb20gXCJ0bnMtY29yZS1tb2R1bGVzL3BsYXRmb3JtXCI7XG5pbXBvcnQgeyBTd2lwZUxheW91dCwgU3dpcGVMZWZ0RXZlbnREYXRhLCBTd2lwZVJpZ2h0RXZlbnREYXRhIH0gZnJvbSBcIi4uL25hdGl2ZXNjcmlwdC1zd2lwZS1sYXlvdXRcIjtcbmltcG9ydCB7IEFOSU1BVElPTl9TVEFURSwgR0VTVFVSRV9NT0RFIH0gZnJvbSBcIi4uL25hdGl2ZXNjcmlwdC1zd2lwZS1sYXlvdXQvc3dpcGUtbGF5b3V0LmVudW1zXCI7XG5pbXBvcnQgeyBhbmltYXRlLCBzdHlsZSwgdHJhbnNpdGlvbiwgdHJpZ2dlciB9IGZyb20gXCJAYW5ndWxhci9hbmltYXRpb25zXCI7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiBcIkhvbWVcIixcbiAgICBtb2R1bGVJZDogbW9kdWxlLmlkLFxuICAgIHRlbXBsYXRlVXJsOiBcIi4vaG9tZS5jb21wb25lbnQuaHRtbFwiLFxuICAgIGFuaW1hdGlvbnM6IFtcbiAgICAgICAgdHJpZ2dlcihcImZhZGVcIiwgW1xuICAgICAgICAgICAgdHJhbnNpdGlvbihcIjplbnRlclwiLCBbXG4gICAgICAgICAgICAgICAgc3R5bGUoeyBvcGFjaXR5OiAwIH0pLFxuICAgICAgICAgICAgICAgIGFuaW1hdGUoMjAwLCBzdHlsZSh7IG9wYWNpdHk6IDEgfSkpXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgICAgIHRyYW5zaXRpb24oXCI6bGVhdmVcIiwgW1xuICAgICAgICAgICAgICAgIGFuaW1hdGUoMjAwLCBzdHlsZSh7IG9wYWNpdHk6IDAgfSkpXG4gICAgICAgICAgICBdKVxuICAgICAgICBdKVxuICAgIF1cbn0pXG5leHBvcnQgY2xhc3MgSG9tZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJDb250ZW50SW5pdCB7XG4gICAgY2FyZHM6IEFycmF5PElEYXRhSXRlbT47XG4gICAgZ2VzdHVyZU1vZGU6IEdFU1RVUkVfTU9ERTtcbiAgICBpc0xvYWRlZDogYm9vbGVhbiA9IGZhbHNlO1xuICAgIHN3aXBlTGF5b3V0QW5pbWF0ZWQ6IEFOSU1BVElPTl9TVEFURTtcbiAgICBwcml2YXRlIF9zd2lwZUxheW91dHM6IEFycmF5PFN3aXBlTGF5b3V0PjtcbiAgICBwcml2YXRlIF9jdXJyZW50U3dpcGVMYXlvdXQ6IFN3aXBlTGF5b3V0O1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBfZGF0YVNlcnZpY2U6IERhdGFTZXJ2aWNlLCBwcml2YXRlIF9jZDogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgICAgICAgdGhpcy5fc3dpcGVMYXlvdXRzID0gW107XG4gICAgICAgIHRoaXMuc3dpcGVMYXlvdXRBbmltYXRlZCA9IEFOSU1BVElPTl9TVEFURS5PTl9FVkVOVFM7XG4gICAgICAgIHRoaXMuZ2VzdHVyZU1vZGUgPSBHRVNUVVJFX01PREUuRFJBRztcbiAgICB9XG5cbiAgICBuZ0FmdGVyQ29udGVudEluaXQoKTogdm9pZCB7XG4gICAgICAgIGlmIChpc0FuZHJvaWQpIHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNMb2FkZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSwgMjIwMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzTG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH0sIDUwMCk7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLmluaXRDYXJkcygpO1xuICAgIH1cblxuICAgIGluaXRDYXJkcygpIHtcbiAgICAgICAgdGhpcy5jYXJkcyA9IHRoaXMuX2RhdGFTZXJ2aWNlLmdldFVuc2Vlbkl0ZW1zKCkucmV2ZXJzZSgpIHx8IFtdO1xuICAgIH1cblxuICAgIHN3aXBlTGF5b3V0TG9hZGVkKGV2ZW50LCBidG5MaWtlLCBidG5JZ25vcmUsIGJhZGdlTGlrZSwgYmFkZ2VJZ25vcmUpIHtcbiAgICAgICAgY29uc3Qgc3dpcGVMYXlvdXQ6IFN3aXBlTGF5b3V0ID0gPFN3aXBlTGF5b3V0PmV2ZW50Lm9iamVjdDtcbiAgICAgICAgdGhpcy5fc3dpcGVMYXlvdXRzLnB1c2goc3dpcGVMYXlvdXQpO1xuICAgICAgICBzd2lwZUxheW91dC5vbihHZXN0dXJlVHlwZXMucGFuLCAoYXJnczogUGFuR2VzdHVyZUV2ZW50RGF0YSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdmVjdG9yTGVuZ3RoID0gKE1hdGguc3FydChNYXRoLnBvdyhhcmdzLmRlbHRhWCwgMikgKyBNYXRoLnBvdyhhcmdzLmRlbHRhWSwgMikpKTtcbiAgICAgICAgICAgIGJ0bkxpa2Uub3BhY2l0eSA9IHRoaXMubWFwVmVjdG9yTGVuZ3RoVG9PcGFjaXR5KHZlY3Rvckxlbmd0aCk7XG4gICAgICAgICAgICBidG5JZ25vcmUub3BhY2l0eSA9IHRoaXMubWFwVmVjdG9yTGVuZ3RoVG9PcGFjaXR5KHZlY3Rvckxlbmd0aCk7XG4gICAgICAgICAgICBiYWRnZUxpa2Uub3BhY2l0eSA9IHRoaXMuYmFkZ2VPcGFjaXR5KGFyZ3MuZGVsdGFYKTtcbiAgICAgICAgICAgIGJhZGdlSWdub3JlLm9wYWNpdHkgPSB0aGlzLmJhZGdlT3BhY2l0eSgtYXJncy5kZWx0YVgpO1xuICAgICAgICB9KTtcbiAgICAgICAgc3dpcGVMYXlvdXQub24oR2VzdHVyZVR5cGVzLnRvdWNoLCAoYXJnczogVG91Y2hHZXN0dXJlRXZlbnREYXRhKSA9PiB7XG4gICAgICAgICAgICBpZiAoYXJncy5hY3Rpb24gPT09IFwidXBcIikge1xuICAgICAgICAgICAgICAgIGJ0bkxpa2UuYW5pbWF0ZSh7IG9wYWNpdHk6IDEsIGR1cmF0aW9uOiA1MDAgfSk7XG4gICAgICAgICAgICAgICAgYnRuSWdub3JlLmFuaW1hdGUoeyBvcGFjaXR5OiAxLCBkdXJhdGlvbjogNTAwIH0pO1xuICAgICAgICAgICAgICAgIGJhZGdlTGlrZS5hbmltYXRlKHsgb3BhY2l0eTogMCwgZHVyYXRpb246IDUwMCB9KTtcbiAgICAgICAgICAgICAgICBiYWRnZUlnbm9yZS5hbmltYXRlKHsgb3BhY2l0eTogMCwgZHVyYXRpb246IDUwMCB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgb25Db250YWluZXJMb2FkZWQoYXJncykge1xuICAgICAgICB0aGlzLl9jdXJyZW50U3dpcGVMYXlvdXQgPSB0aGlzLl9zd2lwZUxheW91dHNbMF07XG4gICAgfVxuXG4gICAgc3dpcGVMZWZ0Q2FsbGJhY2soc3dpcGVMZWZ0RXZlbnQ6IFN3aXBlTGVmdEV2ZW50RGF0YSwgY2FyZDogSURhdGFJdGVtKSB7XG4gICAgICAgIGNhcmQubGlrZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5uZXh0KGNhcmQpO1xuICAgIH1cblxuICAgIHN3aXBlUmlnaHRDYWxsYmFjayhzd2lwZVJpZ2h0RXZlbnQ6IFN3aXBlUmlnaHRFdmVudERhdGEsIGNhcmQ6IElEYXRhSXRlbSkge1xuICAgICAgICBjYXJkLmxpa2VkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5uZXh0KGNhcmQpO1xuICAgIH1cblxuICAgIGRlY2xpbmUoY2FyZDogSURhdGFJdGVtKSB7XG4gICAgICAgIGNhcmQubGlrZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fY3VycmVudFN3aXBlTGF5b3V0LmFuaW1hdGVTd2lwZVJpZ2h0KCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm5leHQoY2FyZCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGxpa2UoY2FyZDogSURhdGFJdGVtKSB7XG4gICAgICAgIGNhcmQubGlrZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLl9jdXJyZW50U3dpcGVMYXlvdXQuYW5pbWF0ZVN3aXBlTGVmdCgpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5uZXh0KGNhcmQpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICB0cmFja2luZ0Z1bmN0aW9uKGluZGV4LCBpdGVtKSB7XG4gICAgICAgIHJldHVybiBpdGVtLmlkO1xuICAgIH1cblxuICAgIHJlc2V0Q2FyZHMoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuX2RhdGFTZXJ2aWNlLnJlc2V0SXRlbXMoKTtcbiAgICAgICAgdGhpcy5pbml0Q2FyZHMoKTtcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5jYXJkcy5sZW5ndGgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgbWFwVmVjdG9yTGVuZ3RoVG9PcGFjaXR5KGw6IG51bWJlcikge1xuICAgICAgICByZXR1cm4gKGwgLSAwKSAqICgwIC0gMSkgLyAoODAgLSAwKSArIDE7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBiYWRnZU9wYWNpdHkoZGVsdGFYOiBudW1iZXIpIHtcbiAgICAgICAgcmV0dXJuIChkZWx0YVggLSAyMCkgKiAoMSAtIDApIC8gKDEyMCAtIDIwKSArIDA7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBuZXh0KGNhcmQ6IElEYXRhSXRlbSkge1xuICAgICAgICBjYXJkLnZpZXdlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuX3N3aXBlTGF5b3V0cy5zaGlmdCgpO1xuICAgICAgICB0aGlzLmNhcmRzLnNoaWZ0KCk7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRTd2lwZUxheW91dCA9IHRoaXMuX3N3aXBlTGF5b3V0c1swXTtcbiAgICAgICAgdGhpcy5fZGF0YVNlcnZpY2UudXBkYXRlSXRlbShjYXJkKTtcbiAgICAgICAgdGhpcy5fY2QuZGV0ZWN0Q2hhbmdlcygpO1xuICAgIH1cbn1cbiJdfQ==